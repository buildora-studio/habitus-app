name: CI

on:
    pull_request:
        branches: [main]

jobs:
    validate:
        name: Run Validations
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ›ï¸ Checkout repo
              uses: actions/checkout@v4
              with:
                  fetch-depth: 2

            - name: ğŸ§© Enable pnpm
              run: corepack enable pnpm

            - name: ğŸ“¦ Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: lts/*
                  cache: "pnpm"

            - name: ğŸ“¥ Install dependencies
              run: pnpm install --frozen-lockfile

            # Optional: setup Turbo Remote Caching (if you use it)
            - name: âš¡ Setup Turborepo Remote Cache
              if: env.TURBO_TOKEN != ''
              run: echo "âœ… Turborepo remote cache ready"
              env:
                  TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}

            - name: ğŸš€ Run affected pipelines
              run: |
                  # Detect changes automatically using Turborepo
                  pnpm turbo run lint test:cov --filter=...[HEAD^1]

            - name: âœ… Done
              run: echo "CI validations complete for changed apps âœ…"
